<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fitwork.back.admin.model.repository.AdminRepository">
	<!-- 방문자 수 추가 또는 업데이트 -->
    <insert id="insertOrUpdateVisitorCount" parameterType="map">
        INSERT INTO visitor_stats (visit_date, visitor_count)
        VALUES (#{visitDate}, 1)
        ON DUPLICATE KEY UPDATE
        visitor_count = visitor_count + 1;
    </insert>

    <!-- 일별 방문자 통계 조회 -->
    <select id="getDailyStats" resultType="VisitorStats">
        SELECT visit_date, visitor_count FROM visitor_stats ORDER BY visit_date DESC LIMIT 30;
    </select>

    <!-- 주별 방문자 통계 조회 -->
    <select id="getWeeklyStats" resultType="VisitorStats">
        SELECT WEEK(visit_date) AS week, SUM(visitor_count) AS visitor_count
        FROM visitor_stats
        GROUP BY week ORDER BY week DESC LIMIT 10;
    </select>

    <!-- 월별 방문자 통계 조회 -->
    <select id="getMonthlyStats" resultType="VisitorStats">
        SELECT MONTH(visit_date) AS month, SUM(visitor_count) AS visitor_count
        FROM visitor_stats
        GROUP BY month ORDER BY month DESC LIMIT 12;
    </select>	
</mapper>